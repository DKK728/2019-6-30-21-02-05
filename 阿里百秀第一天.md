# 阿里百秀第一天

> 目标
>
> 1.能说出什么是B/S架构
>
> 2.能说出什么是动态网站
>
> 3.了解网站的开发流程
>
> 4.搭建出项目的基本结构
>
> 5.实现后台侧边栏的跳转和展开



## 为什么要做这个项目

- 了解 Web 开发过程(前端的角色)
- 掌握基本的动态网站开发
- 培养 B/S 架构应用开发思维
- 锻炼 JavaScript jQuery AJAX

## B/S架构

B：browser - 浏览器

S : server - 服务器

值的就是浏览器和服务器就可以搭建起来的一个应用架构

浏览器的功能比不上专门的客户端，但是只要数据在服务器更新了，就可以直接在浏览器看到

浏览器只要有一个就可以跑——只要养一个前端团队就可以了



c/s架构

client to server 

大型的网络游戏 - 客户端可以具备非常强大的功能

但是每次有更新，就得把所有的数据，从服务器获取下来

只要是你想要占领某个平台——苹果的团队、安卓团队、window的团队



## 动态网站的本质

所谓的动态网站，指的是数据层面的动，并不是页面视觉层面的动。

我们必须要有一个数据源头，当每次请求到服务器接口，通过服务器脚本，获取数据库中最新的数据，然后动态组织（生成）一个 HTML 页面（其实是一个满足html语法的字符串），返回给浏览器，浏览器解析成页面展示给用户——**就是动态网站的本质**

目前来说，市面上的网站绝大多数都是动态网站。所以我们必须掌握动态网站的开发。

------

## 开发流程简介

了解了动态网站的概念过后，我们作为开发者更多想到的就是如何具体开发一个动态网站应用程序，有那些具体的工作，流程是怎样的？

正常情况下，我们大概会有如下几个阶段：

1. **需求分析**：分析我们这个应用程序到底要去做哪些功能，应对哪些业务。
2. **原型设计**：根据需求分析的结果规划应用程序的原型，可以理解为“打草稿”（花不了太多的时间，收效是很大的）。
3. **UI 设计**：将“草稿”转换为设计稿，并提供相应的产物（设计稿、静态页面）。
4. **技术选型**：根据业务场景分别选择对应的技术栈（数据库技术栈、后端技术栈、前端技术栈），一般考虑的因素：人、业务。
5. **数据库设计**：根据需求和原型分析我们有哪些类型的数据需要存，从而得到我们数据库的基本结构。
6. **项目架构设计**：俗称搭架构，其中具体的操作主要就是制定项目规范约束、创建基本的项目结构、编写基础的公共模块代码和组织代码。
7. **业务迭代开发**：开发者的日常，基于项目架构（条条框框）下完成各项业务功能。
8. **集中测试**：将所有功能模块整合到一起过后，集中测试业务功能是否有 BUG，是否满足需求。
9. **部署上线**：从开发环境向生产环境转换，就是把应用部署到服务器上。

------

## 一些应该要区分的概念

1. **前台**
   - 前台一般就是用来展示数据给用户看的网站
2. **后台**
   - 一般是指用于管理前台数据的另一个网站
3. **前端**
   - 负责前台开发的工作人员
4. **后端**
   - 负责服务端开发的工作人员



- 

## 数据库设计

> 根据我们的业务需要设计数据库的结构，这个过程是每个项目开始时所必须的，一般由专门的 DBA 角色完成（很多没有划分的非常具体的公司由后端开发人员兼任）。



### 选项表（options）

用于记录网站的一些配置属性信息，如：站点标题，站点描述等

| 字段  | 描述   | 备注       |
| ----- | ------ | ---------- |
| id    | 🔑 主键 | &nbsp;     |
| key   | 属性键 | snake_case |
| value | 属性值 | JSON 格式  |

### 用户表（users）

用于记录用户信息

| 字段     | 描述     | 备注                                                         |
| -------- | -------- | ------------------------------------------------------------ |
| id       | 🔑 主键   | &nbsp;                                                       |
| slug     | URL 别名 | &nbsp;                                                       |
| email    | 邮箱     | 亦做登录名                                                   |
| password | 密码     | &nbsp;                                                       |
| nickname | 昵称     | &nbsp;                                                       |
| avatar   | 头像     | 图片 URL 路径                                                |
| bio      | 简介     | &nbsp；                                                      |
| status   | 状态     | 未激活（unactivated）/ 激活（activated）/ 禁止（forbidden）/ 回收站（trashed） |

### 文章表（posts）

用于记录文章信息

| 字段        | 描述      | 备注                                                    |
| ----------- | --------- | ------------------------------------------------------- |
| id          | 🔑 主键    | &nbsp;                                                  |
| slug        | URL 别名  | &nbsp;                                                  |
| title       | 标题      | &nbsp;                                                  |
| feature     | 特色图像  | 图片 URL 路径                                           |
| created     | 创建时间  | &nbsp;                                                  |
| content     | 内容      | &nbsp;                                                  |
| views       | 浏览次数  | &nbsp;                                                  |
| likes       | 点赞数    | &nbsp;                                                  |
| status      | 状态      | 草稿（drafted）/ 已发布（published）/ 回收站（trashed） |
| user_id     | 🔗 用户 ID | 当前文章的作者 ID                                       |
| category_id | 🔗 分类 ID | 当前文章的分类 ID                                       |

> 提问：为什么要用关联 ID？

<!-- 答：数据同步，便于维护 -->

### 分类表（categories）

用于记录文章分类信息

| 字段      | 描述     | 备注   |
| --------- | -------- | ------ |
| id        | 🔑 主键   | &nbsp; |
| slug      | URL 别名 | &nbsp; |
| name      | 分类名称 | &nbsp; |
| classname | 图标类名 |        |

### 评论表（comments）

用于记录文章评论信息

| 字段      | 描述      | 备注                                                         |
| --------- | --------- | ------------------------------------------------------------ |
| id        | 🔑 主键    | &nbsp;                                                       |
| author    | 作者      | &nbsp;                                                       |
| email     | 邮箱      | &nbsp;                                                       |
| created   | 创建时间  | &nbsp;                                                       |
| content   | 内容      | &nbsp;                                                       |
| status    | 状态      | 待审核（held）/ 准许（approved）/ 拒绝（rejected）/ 回收站（trashed） |
| post_id   | 🔗 文章 ID | &nbsp;                                                       |
| parent_id | 🔗 父级 ID | &nbsp;                                                       |



### 数据库设计中的一些概念

当我们发现不同的数据表格之间，存在数据关联，一般不会直接把另一个表中的数据存储到该表格中，而是把数据的id存储过来——称为**主外键关系**

主键 —— id,是以为可以唯一确定该条数据的字段

外键 —— 另一个表格的主键

几个表格之间的关系

![1560306281373](assets/1560306281373.png)



## 开始新建数据库

1.在连接名上面右键新建数据库，数据库名字要自己取，要写成英文字母开头，不要写中文，字符集要求使用utf-8

2.在数据库名称上面右键，运行sql文件，找到教学资料里面的`database.sql` 直接运行，就会在表格里面出现5个表，随意打开某一个，有数据，就成功了



## 搭建项目结构

1.把准备好的静态页面，复制到一个我们要些项目的文件夹里面

2.把所有的静态页面都放到views文件夹里面(项目约束之一)

3.把静态页面中的样式路径修改一下

直接在全部的页面里面，每个单独打开，ctrl+h把需要更改的更改

一个是要把所有的assets开头都改成  /assets

另一个是要把所有的uploads开头都改成  /uploads

为了使用服务器绝对路径，需要先把服务器搭建起来

4.需要先npm初始化 `npm init -y`

5.下载expresss

6.把服务器搭建起来，就需要一个01-app.js,在里面写服务器代码

7.把views里面的所有的html文件，都要修改为ejs模板文件，以便我们后来一动态页面的形式返回给浏览器

可以一个一个的进行修改

8.搭建三层，返回动态的ejs模板文件

8.1下ejs，8.2设置默认的模板引擎，8.3，在pageController里面返回主页

![1560311215651](assets/1560311215651.png)



## 服务器绝对路径

绝对路径： 从盘符开始，经过很多文件夹，找打指定文件的路径

服务器绝对路径： 指从服务器的根目录开始的绝对路径

服务器的根目录： 运行app.js的目录，开始服务器的目录



服务器根目录是一个`/`开头来表示的

如果我们在 albx33目录下开始执行 node 01-app.js `/`代表的就是 albx33这个目录

使用了服务器根目录的路径，必须使用服务器的方式打开



为了验证这个方式是可能性，需要搭建服务器



## 使用cmd命令一次性修改ejs文件的做法

1.win+r开cmd窗口

2.先使用`盘符:` 进入你的项目所在的盘符

3.使用 cd 命令，进入项目的目录里面

4.使用下面的命令 `ren *.html *.ejs`





## 展示一个后台主页

后台网站一般有两种方式访问：

第一种：可以单独给一个域名，然后通过域名直接访问，第二种是把后台和前台放在一个网站里面，通过一个指定的开头，访问后台

约定好： 采用第二个方式，通过 /admin 开头访问后台网站

跟展示前台主页是一样的

1.先在router里面监听后台主页的请求，两个请求 `/amdin`和`/admin/index`

2.在pageController里面封装一个给router调用的方法，返回主页的ejs。注意点：如果views文件夹里面有别的内部文件夹，把ejs放在了内部文件夹里面，可以通过路径的方式把ejs传递给render方法





## 抽离页面的公共模块

公共模块——在页面中，可能有一些部分的代码，是一模一样的，如果每次修改了一个页面，还要修改其他页面的代码，是一件非常麻烦的事情，所以为了维护更加方便，我们会把这些一模一样的代码，抽离称为公共模块

服务器的页面都是动态生成的，动态生成是依赖于`模板引擎`所以抽离公共模块，也是模板引擎提供的功能。

1.把页面中可能需要重复使用的代码，抽离到一个单独的ejs文件里面

1.1先在admin文件夹下面新建了一个layouts文件夹，在里面新建了一个admin_aside.ejs文件

1.2把每个页面里面都有的aside这个div剪切到了admin_aside.ejs里面

2.在需要引入的页面里面使用如下代码把公共模块引入

```ejs
<%- include('layouts/admin_aside'); %>
```

注意点：一定要严格安装ejs的语法来实现





## 在公共模块里面把所有的跳转的路径都修改一下

只要按照约定，从当前目录，跳转到另一个也，需要把  原本的  xxx.html 修改为：  ./xxx

约定1：所有的页面请求都是不带.html的

约定2：请求后台页面的时候，都是一下 /admin开头，如果从某个后台页面跳转到另一个后台页面，浏览器里面已经自带/admin开头了，只要从当前目录跳转即可

之后，只要在router和controller里面实现每个页面的监听即可

















